---
title: "Data manipulation with tidyr"
output: html_document
---

Use tidyr for data manipulation. tidyr is a package by Hadley Wickham that makes it easy to tidy your data. It is often used in conjunction with dplyr. Data is said to be tidy when each column represents a variable, and each row represents an observation.

Demonstrate the usage of the following four functions from the tidyr package:

- **gather** – converts wide data to longer format. It is analogous to the melt function from reshape2.
- **spread** – converts long data to wider format. It is analogous to the cast function from reshape2.
- **unite** – combines two or more columns into a single column.
- **separate** – splits one column into two or more columns.

I will use the mtcars dataset from the datasets library. If you are not familiar with it, this is what it looks like:
```{r message=FALSE, warning=FALSE}
library(tidyr)
library(dplyr)
head(mtcars)
```

Let us include the names of the cars in a column called car for easier manipulation.
```{r message=FALSE, warning=FALSE}
mtcars$car <- rownames(mtcars)
mtcars$car
mtcars <- mtcars[, c(12, 1:11)]
head(mtcars)
```

##gather

gather takes the form (from the help file):
gather(data, key, value, ..., na.rm = FALSE, convert = FALSE)

where ... is the specification of the columns to gather.

We can replicate what melt does as follows:
```{r}
mtcarsNew <- mtcars %>% gather(attribute, value, -car)
head(mtcarsNew)

tail(mtcarsNew)
```

As you can see, it gathers all the columns except car and places their name and value into the attritube and value column respectively.

The great thing about tidyr is that you can gather only certain columns and leave the others alone. If we want to gather all the columns from mpg to gear and leave the carb and car columns as they are, we can do it as follows:
```{r}
mtcarsNew <- mtcars %>% gather(attribute, value, mpg:gear)
head(mtcarsNew)
```

##spread

spread takes the form(from the help file):
spread(data, key, value, fill = NA, convert = FALSE, drop = TRUE)

We can replicate what cast does as follows:
```{r}
mtcarsSpread <- mtcarsNew %>% spread(attribute, value)
head(mtcarsSpread)
```

##unite

unite takes the form (from the help file):
unite(data, col, ..., sep = "_", remove = TRUE)

where ... represents the columns to unite and col represents the column to add.

Let us create some fake data:
```{r}
set.seed(1)
date <- as.Date('2016-01-01') + 0:14
hour <- sample(1:24, 15)
min <- sample(1:60, 15)
second <- sample(1:60, 15)
event <- sample(letters, 15)
data <- data.frame(date, hour, min, second, event)
data
```
Now, let us combine the date, hour, min, and second columns into a new column called datetime. Usually, datetime in R is of the form Year-Month-Day Hour:Min:Second.
```{r}
dataNew <- data %>%
  unite(datehour, date, hour, sep = ' ') %>%
  unite(datetime, datehour, min, second, sep = ':')
dataNew
```

##separate

separate takes the form (from the help file):
separate(data, col, into, sep = "[^[:alnum:]]+", remove = TRUE,
  convert = FALSE, extra = "warn", fill = "warn", ...)

We can get back the original data we created using separate as follows:
```{r}
data1 <- dataNew %>% 
  separate(datetime, c('date', 'time'), sep = ' ') %>% 
  separate(time, c('hour', 'min', 'second'), sep = ':')
data1
```

It first splits the datetime column into date and time, and then splits time into hour, min, and second.
